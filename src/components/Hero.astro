---
const { eyebrow, title, subtitle, lead, ctas, heroImage, backgroundImage } = Astro.props;

// Helper functie om de basis image naam te krijgen (zonder width suffix)
function getBaseImagePath(src: string): string {
  // Verwijder eventuele width suffixen zoals -400w, -800w, -1200w, -1920w
  return src.replace(/-\d+w\.avif$/, '.avif');
}

// Genereer responsive image paths
function getResponsiveImagePath(basePath: string, width: string): string {
  return basePath.replace('.avif', `-${width}w.avif`);
}

let baseImagePath = '';
let imageSrc = '';
let imageSrcset = '';

if (backgroundImage) {
  baseImagePath = getBaseImagePath(backgroundImage.src);
  imageSrc = getResponsiveImagePath(baseImagePath, '1200');
  imageSrcset = [
    `${getResponsiveImagePath(baseImagePath, '400')} 400w`,
    `${getResponsiveImagePath(baseImagePath, '800')} 800w`,
    `${getResponsiveImagePath(baseImagePath, '1200')} 1200w`,
    `${getResponsiveImagePath(baseImagePath, '1920')} 1920w`
  ].join(', ');
}
---
<section class={backgroundImage ? "relative py-12 sm:py-16 overflow-hidden min-h-[400px] sm:min-h-[500px] md:min-h-[600px] flex items-start pt-20 sm:pt-24" : "bg-gradient-to-br from-primary-50 via-red-50 to-orange-50 py-12 sm:py-16 md:py-20 relative overflow-hidden"}>
  <!-- Background image (only for homepage) -->
  {backgroundImage && (
    <div class="absolute inset-0 min-h-full">
      <img 
        src={imageSrc}
        srcset={imageSrcset}
        sizes="100vw"
        alt={backgroundImage.alt} 
        class="w-full h-full min-h-full object-cover object-center"
        loading="eager"
        fetchpriority="high"
        width="1920"
        height="1080"
        decoding="async"
      />
      <div class="absolute inset-0 bg-gradient-to-r from-slate-900/70 via-slate-800/60 to-slate-900/70"></div>
    </div>
  )}
  
  <!-- Background decoration -->
  <div class="absolute inset-0 bg-gradient-to-r from-primary-600/5 to-orange-600/5"></div>
  <div class="absolute top-0 left-0 w-full h-full">
    <div class="absolute top-10 left-10 w-20 h-20 bg-primary-200/30 rounded-full blur-xl"></div>
    <div class="absolute bottom-10 right-10 w-32 h-32 bg-orange-200/30 rounded-full blur-xl"></div>
  </div>
  
  <div class="max-w-6xl mx-auto px-4 sm:px-6 text-center relative z-10">
    {eyebrow && (
      <p class={backgroundImage ? "text-primary-300 font-semibold mb-3 sm:mb-4 text-sm sm:text-base md:text-lg tracking-wide uppercase" : "text-primary-600 font-semibold mb-3 sm:mb-4 text-sm sm:text-base md:text-lg tracking-wide uppercase"}>
        {eyebrow}
      </p>
    )}
    <h1 class={backgroundImage ? "hero-heading font-bold text-white mb-4 sm:mb-6 md:mb-8 leading-tight drop-shadow-lg px-2 text-pretty" : "hero-heading font-bold text-slate-900 mb-4 sm:mb-6 md:mb-8 leading-tight px-2 text-pretty"}>
      {title}
    </h1>
    {subtitle && (
      <p class={backgroundImage ? "text-base sm:text-lg md:text-xl lg:text-2xl text-slate-200 mb-4 sm:mb-6 max-w-3xl mx-auto leading-relaxed drop-shadow-md px-2" : "text-base sm:text-lg md:text-xl lg:text-2xl text-slate-600 mb-4 sm:mb-6 max-w-3xl mx-auto leading-relaxed px-2"}>
        {subtitle}
      </p>
    )}
    {lead && (
      <p class={backgroundImage ? "text-sm sm:text-base md:text-lg text-slate-200 mb-8 sm:mb-10 md:mb-12 max-w-4xl mx-auto leading-relaxed drop-shadow-md px-2" : "text-sm sm:text-base md:text-lg text-slate-600 mb-8 sm:mb-10 md:mb-12 max-w-4xl mx-auto leading-relaxed px-2"}>
        {lead}
      </p>
    )}
    {ctas && ctas.length > 0 && (
      <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 md:gap-6 justify-center items-center px-2">
        {ctas.map((cta) => {
          // Check if this is the "Inschrijven" button that should scroll
          const isInschrijvenButton = cta.href === '/#inschrijven' || cta.href === '#inschrijven';
          return (
            <a 
              href={cta.href}
              data-smooth-scroll={isInschrijvenButton ? 'true' : undefined}
              class={backgroundImage ? "inline-block w-full sm:w-auto px-4 sm:px-6 md:px-8 py-3 sm:py-3.5 md:py-4 bg-primary-600 text-white rounded-xl font-semibold text-sm sm:text-base md:text-lg hover:bg-primary-700 hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300 shadow-md backdrop-blur-sm bg-white/10 border border-white/20 text-center" : "inline-block w-full sm:w-auto px-4 sm:px-6 md:px-8 py-3 sm:py-3.5 md:py-4 bg-primary-600 text-white rounded-xl font-semibold text-sm sm:text-base md:text-lg hover:bg-primary-700 hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300 shadow-md text-center"}
            >
              {cta.label}
            </a>
          );
        })}
      </div>
    )}
  </div>
</section>

<script>
  // Smooth scroll voor inschrijven knop
  document.addEventListener('DOMContentLoaded', () => {
    const inschrijvenLinks = document.querySelectorAll('a[data-smooth-scroll="true"]');
    
    inschrijvenLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const href = link.getAttribute('href');
        
        // Check of het een hash link is
        if (href && href.includes('#inschrijven')) {
          e.preventDefault();
          
          const targetId = href.includes('#') ? href.split('#')[1] : 'inschrijven';
          const targetElement = document.getElementById(targetId);
          
          if (targetElement) {
            // Smooth scroll naar de sectie
            targetElement.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
            
            // Optioneel: open modal na scroll (met kleine delay)
            setTimeout(() => {
              if (typeof window.openInschrijfModal === 'function') {
                window.openInschrijfModal('team');
              }
            }, 800); // Wacht tot scroll klaar is
          }
        }
      });
    });
  });
</script>
